<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community - Profile</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        body { background: #000; color: #ccc; font-family: sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px 0; }
        
        .profile-card { background: rgba(17, 17, 17, 0.9); border: 1px solid #00ff41; padding: 25px; border-radius: 12px; width: 90%; max-width: 420px; text-align: center; backdrop-filter: blur(10px); box-shadow: 0 0 15px rgba(0, 255, 65, 0.2); }
        
        .avatar-container { position: relative; width: 100px; height: 100px; margin: 0 auto 15px; }
        .avatar-display { width: 100px; height: 100px; border-radius: 50%; border: 2px solid #00ff41; display: flex; align-items: center; justify-content: center; background: #111; font-size: 50px; overflow: hidden; object-fit: cover; }
        
        .upload-icon { position: absolute; bottom: 0; right: 0; background: #00ff41; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; border: 2px solid #000; }

        .input-group { text-align: left; margin-top: 15px; }
        label { font-size: 12px; color: #00ff41; margin-left: 5px; }
        
        input, textarea, select { width: 100%; background: #000; border: 1px solid #444; color: #00ff41; padding: 10px; margin-top: 5px; border-radius: 4px; outline: none; box-sizing: border-box; font-size: 14px; }
        
        button { width: 100%; background: #00ff41; color: #000; border: none; padding: 12px; margin-top: 20px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #00cc33; }
        .back-btn { background: transparent; color: #00ff41; border: 1px solid #00ff41; margin-top: 10px; }
        
        #status { font-size: 11px; margin-top: 15px; color: #00ff41; min-height: 15px; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="profile-card">
    <div class="avatar-container">
        <div id="avatar-view" class="avatar-display">üë§</div>
        <label for="img-input" class="upload-icon" title="Upload Photo">üì∑</label>
        <input type="file" id="img-input" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
    </div>

    <h3 id="display-name" style="color:#00ff41; margin: 0;">User_Name</h3>
    <p id="user-email" style="font-size: 11px; color: #666; margin: 5px 0 15px 0;"></p>

    <div class="input-group">
        <label>·Äî·Ä¨·Äô·Ä±</label>
        <input type="text" id="username" placeholder="·Äî·Ä¨·Äô·Ä±·Ä°·Äû·ÄÖ·Ä∫...">
    </div>

    <div style="display: flex; gap: 10px;">
        <div class="input-group" style="flex: 1;">
            <label>·Ä°·Äû·ÄÄ·Ä∫</label>
            <input type="number" id="age" placeholder="·Ä°·Äû·ÄÄ·Ä∫">
        </div>
        <div class="input-group" style="flex: 1;">
            <label>·Äú·Ä≠·ÄÑ·Ä∫</label>
            <select id="gender">
                <option value="·Äô·Äõ·ÄΩ·Ä±·Ä∏·Äõ·Äû·Ä±·Ä∏">·Äõ·ÄΩ·ÄÆ·Ä∏·Äï·Ä´</option>
                <option value="·ÄÄ·Äª·Ä¨·Ä∏">·ÄÄ·Äª·Ä¨·Ä∏</option>
                <option value="·Äô">·Äô</option>
                <option value="·Ä°·ÄÅ·Äº·Ä¨·Ä∏">·Ä°·ÄÅ·Äº·Ä¨·Ä∏</option>
            </select>
        </div>
    </div>

    <div class="input-group">
        <label>·Äô·ÄΩ·ÄÆ·Ä∏·Äû·ÄÄ·Äπ·ÄÄ·Äõ·Ä¨·Äá·Ä∫</label>
        <input type="date" id="birthday">
    </div>

    <div class="input-group">
        <label>·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äõ·Ä±·Ä∏·Ä°·ÄÄ·Äª·Äâ·Ä∫·Ä∏ (Bio)</label>
        <textarea id="bio" rows="2" placeholder="·ÄÄ·Ä≠·ÄØ·Äö·Ä∑·Ä∫·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏..."></textarea>
    </div>
    
   <div style="display: flex; gap: 10px; flex-direction: column;">
    <button onclick="saveProfile()" id="saveBtn">UPDATE PROFILE</button>
    
    <button id="msgBtn" style="background: #0084ff; color: #fff; display: none;" onclick="goToChat()">MESSAGE</button>
    
    <button class="back-btn" onclick="window.location.href='forum.html'">BACK TO FORUM</button>
</div>
<script>
    // --- Firebase Setup ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    // Matrix BG (·Äô·Ä∞·Äõ·ÄÑ·Ä∫·Ä∏·Ä°·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏)
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width / 16)).fill(1);
    function draw() {
        ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "#00ff41"; ctx.font = "16px monospace";
        drops.forEach((y, i) => {
            ctx.fillText("01"[Math.floor(Math.random()*2)], i*16, y*16);
            if(y*16 > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        });
    }
    setInterval(draw, 50);

    // --- Profile Logic ·Ä°·Äû·ÄÖ·Ä∫ ---
    const urlParams = new URLSearchParams(window.location.search);
    const viewId = urlParams.get('id'); // URL ·ÄÄ id ·ÄÄ·Ä≠·ÄØ ·Äñ·Äê·Ä∫·Äô·Äö·Ä∫

    firebase.auth().onAuthStateChanged(user => {
        if (!user) {
            window.location.href = "index.html";
            return;
        }

        const myId = user.uid;
        // ·Äê·ÄÄ·Äö·Ä∫·Äú·Ä≠·ÄØ·Ä∑ URL ·Äô·Äæ·Ä¨ ID ·Äô·Äï·Ä´·Äõ·ÄÑ·Ä∫ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∑·Ä∫ Profile ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äô·Äö·Ä∫
        // ID ·Äï·Ä´·ÄÅ·Ä≤·Ä∑·Äõ·ÄÑ·Ä∫ ·Ä°·Ä≤·Ä∑·Äí·ÄÆ ID ·Äõ·Ä≤·Ä∑ Data ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äô·Äö·Ä∫
        const targetId = viewId || myId;
        const isMyProfile = (targetId === myId);

        // Edit Button ·Äê·ÄΩ·Ä±·Äî·Ä≤·Ä∑ Input ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∑·Ä∫ Profile ·Äô·Äü·ÄØ·Äê·Ä∫·Äõ·ÄÑ·Ä∫ ·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫
        if (!isMyProfile) {
            document.getElementById('saveBtn').style.display = 'none';
            document.getElementById('username').readOnly = true;
            document.getElementById('age').readOnly = true;
            document.getElementById('gender').disabled = true;
            document.getElementById('birthday').readOnly = true;
            document.getElementById('bio').readOnly = true;
            document.querySelector('.upload-icon').style.display = 'none'; // ·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äê·Ä≤·Ä∑ icon ·Äñ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äö·Ä∫
            document.getElementById('username').placeholder = "";
            document.getElementById('bio').placeholder = "·Äò·Ä¨·Äô·Äæ·Äõ·Ä±·Ä∏·Äô·Äë·Ä¨·Ä∏·Äï·Ä´...";
        }

        // Data ·ÄÜ·ÄΩ·Ä≤·Äë·ÄØ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
        db.ref('users/' + targetId).on('value', s => {
            const data = s.val() || {};
            document.getElementById('user-email').innerText = isMyProfile ? user.email : "PROFILE_INFO";
            document.getElementById('username').value = data.username || "·Ä°·Äô·Ää·Ä∫·Äô·Äõ·Äæ·Ä≠";
            document.getElementById('display-name').innerText = data.username || "User";
            document.getElementById('age').value = data.age || "";
            document.getElementById('gender').value = data.gender || "·Äô·Äõ·ÄΩ·Ä±·Ä∏·Äõ·Äû·Ä±·Ä∏";
            document.getElementById('birthday').value = data.birthday || "";
            document.getElementById('bio').value = data.bio || "";
            
            const avatarView = document.getElementById('avatar-view');
            if (data.profilePic && data.profilePic.startsWith('http')) {
                avatarView.innerHTML = `<img src="${data.profilePic}" style="width:100%; height:100%; object-fit:cover;">`;
            } else {
                avatarView.innerHTML = data.profilePic || "üë§";
            }
        });
    });

    // --- Save & Upload Functions (·Äô·Ä∞·Äõ·ÄÑ·Ä∫·Ä∏·Ä°·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏) ---
    async function uploadAvatar(input) {
        if (!input.files || !input.files[0]) return;
        const status = document.getElementById('status');
        status.innerText = "UPLOADING...";
        const fd = new FormData();
        fd.append("image", input.files[0]);
        try {
            const res = await fetch("https://api.imgbb.com/1/upload?key=926060156d59194f53e97f7cec5ff5a2", {method: "POST", body: fd});
            const resData = await res.json();
            if (resData.success) {
                await db.ref('users/' + firebase.auth().currentUser.uid).update({ profilePic: resData.data.url });
                status.innerText = "UPDATED!";
            }
        } catch (e) { status.innerText = "FAILED!"; }
    }

    function saveProfile() {
        const user = firebase.auth().currentUser;
        const updates = {
            username: document.getElementById('username').value,
            age: document.getElementById('age').value,
            gender: document.getElementById('gender').value,
            birthday: document.getElementById('birthday').value,
            bio: document.getElementById('bio').value
        };
        db.ref('users/' + user.uid).update(updates).then(() => {
            document.getElementById('status').innerText = "SAVED!";
            setTimeout(() => document.getElementById('status').innerText = "", 2000);
        });
    }
</script>
</body>
</html>
