<!DOCTYPE html>
<html>
<head>
    <title>User Profile</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { background: #0a0a0a; color: #333; font-family: sans-serif; margin: 0; padding: 10px; }
        .profile-card { max-width: 400px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 20px; text-align: center; border: 3px solid #00ff41; }
        
        /* Emoji Avatar Style */
        .avatar-display { font-size: 80px; background: #f0f0f0; width: 120px; height: 120px; line-height: 120px; border-radius: 50%; margin: 0 auto 15px; border: 4px solid #eee; }
        
        .info-table { text-align: left; width: 100%; margin-top: 15px; border-collapse: collapse; }
        .info-table td { padding: 12px; border-bottom: 1px solid #eee; }
        
        /* Emoji Picker */
        .emoji-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; background: #f9f9f9; padding: 10px; border-radius: 10px; }
        .emoji-item { font-size: 30px; cursor: pointer; padding: 5px; border-radius: 8px; transition: 0.2s; border: 2px solid transparent; }
        .emoji-item:hover { background: #e0e0e0; }
        .emoji-item.selected { border-color: #00ff41; background: #e8f5e9; }

        #edit-section { display: none; margin-top: 20px; border-top: 2px dashed #00ff41; padding-top: 20px; text-align: left; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-edit { background: #00ff41; color: #000; }
        .btn-save { background: #007bff; color: #fff; }
        .btn-back { background: #666; color: #fff; }
    </style>
</head>
<body>

<div class="profile-card">
    <div id="p-img" class="avatar-display">üë§</div>
    <h2 id="p-name" style="margin: 10px 0;">Loading...</h2>
    
    <table class="info-table">
        <tr><td><b>·Ä°·Äû·ÄÄ·Ä∫</b></td><td id="p-age">--</td></tr>
        <tr><td><b>·Äú·Ä≠·ÄÑ·Ä∫</b></td><td id="p-gender">--</td></tr>
        <tr><td><b>·Äô·ÄΩ·Ä±·Ä∏·Äî·Ä±·Ä∑</b></td><td id="p-dob">--</td></tr>
    </table>

    <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin-top:15px; text-align:left;">
        <h4 style="margin:0 0 5px 0;">·ÄÖ·Äê·Ä≠·ÄØ·Äú·Ä±·Ä∏ (Bio)</h4>
        <p id="p-bio" style="margin:0; font-style:italic;">...</p>
    </div>

    <button id="edit-btn" class="btn btn-edit" style="display:none;" onclick="toggleEdit()">·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äô·Ä±</button>
    <button class="btn btn-back" onclick="window.history.back()">·Äï·Äº·Äî·Ä∫·Äú·Ä¨·Ä∏·Äô·Ä±</button>

    <div id="edit-section">
        <h3 style="color:#007bff; margin-top:0;">·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äï·Äº·ÄÑ·Ä∫·Äô·Ä±</h3>
        
        <label>·Äî·Ä¨·Äô·Ää·Ä∫:</label>
        <input type="text" id="input-name">

        <label>Emoji ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´:</label>
        <div class="emoji-grid" id="emoji-picker">
            </div>

        <label>·Ä°·Äû·ÄÄ·Ä∫:</label>
        <input type="number" id="input-age">

        <label>·Äú·Ä≠·ÄÑ·Ä∫:</label>
        <select id="input-gender">
            <option value="·ÄÄ·Äª·Ä¨·Ä∏">·ÄÄ·Äª·Ä¨·Ä∏</option>
            <option value="·Äô">·Äô</option>
            <option value="·Ä°·ÄÅ·Äº·Ä¨·Ä∏">·Ä°·ÄÅ·Äº·Ä¨·Ä∏</option>
        </select>

        <label>·Äô·ÄΩ·Ä±·Ä∏·Äî·Ä±·Ä∑:</label>
        <input type="date" id="input-dob">

        <label>·ÄÄ·Ä≠·ÄØ·Äö·Ä∑·Ä∫·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏ (Bio):</label>
        <textarea id="input-bio" rows="3"></textarea>

        <button id="save-btn" class="btn btn-save" onclick="saveProfile()">·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äô·Ä±</button>
    </div>
</div>

<script>
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const profileId = params.get('id');
    let selectedEmoji = "üë§";

    // Emoji ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏
    const emojis = ["üë§", "üë®‚Äçüíª", "üë©‚Äçüíª", "ü•∑", "ü¶Å", "üêØ", "üê±", "ü¶ä", "üëë", "üçÄ", "üî•", "‚ú®"];
    const picker = document.getElementById('emoji-picker');
    
    emojis.forEach(e => {
        const span = document.createElement('span');
        span.className = 'emoji-item';
        span.innerText = e;
        span.onclick = () => selectEmoji(e, span);
        picker.appendChild(span);
    });

    function selectEmoji(emoji, el) {
        selectedEmoji = emoji;
        document.querySelectorAll('.emoji-item').forEach(i => i.classList.remove('selected'));
        el.classList.add('selected');
    }

    if (profileId) {
        db.ref('users/' + profileId).on('value', s => {
            const data = s.val();
            if (data) {
                document.getElementById('p-name').innerText = data.username || "·Ä°·Äô·Ää·Ä∫·Äô·Äû·Ä≠";
                document.getElementById('p-age').innerText = data.age || "--";
                document.getElementById('p-gender').innerText = data.gender || "--";
                document.getElementById('p-dob').innerText = data.dob || "--";
                document.getElementById('p-bio').innerText = data.bio || "·Äò·Ä¨·Äô·Äæ·Äô·Äõ·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äï·Ä´·Äò·Ä∞·Ä∏·Åã";
                document.getElementById('p-img').innerText = data.profilePic || "üë§";
                
                document.getElementById('input-name').value = data.username || "";
                document.getElementById('input-age').value = data.age || "";
                document.getElementById('input-gender').value = data.gender || "·ÄÄ·Äª·Ä¨·Ä∏";
                document.getElementById('input-dob').value = data.dob || "";
                document.getElementById('input-bio').value = data.bio || "";
                selectedEmoji = data.profilePic || "üë§";
            }
        });
    }

    firebase.auth().onAuthStateChanged(user => {
        if (user && user.uid === profileId) {
            document.getElementById('edit-btn').style.display = 'block';
        }
    });

    function toggleEdit() {
        const x = document.getElementById('edit-section');
        x.style.display = (x.style.display === 'none') ? 'block' : 'none';
    }

    async function saveProfile() {
        const user = firebase.auth().currentUser;
        if (!user || user.uid !== profileId) return;

        const updatedData = {
            username: document.getElementById('input-name').value,
            profilePic: selectedEmoji, // Emoji ·ÄÄ·Ä≠·ÄØ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Äö·Ä∫
            age: document.getElementById('input-age').value,
            gender: document.getElementById('input-gender').value,
            dob: document.getElementById('input-dob').value,
            bio: document.getElementById('input-bio').value
        };

        try {
            await db.ref('users/' + user.uid).update(updatedData);
            alert("·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äö·Ä¨!");
            toggleEdit();
        } catch (e) {
            alert("Error: " + e.message);
        }
    }
</script>
</body>
</html>
