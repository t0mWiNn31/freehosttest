<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Arakha Chat</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #0084ff; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; }
        #messages { height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; background: #fafafa; text-align: left; }
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 8px; background: #e4e6eb; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-section">
        <h2 id="title">အကောင့်ဝင်ပါ</h2>
        <input type="email" id="email" placeholder="အီးမေးလ်">
        <input type="password" id="password" placeholder="လျှို့ဝှက်နံပါတ်">
        <button onclick="handleAuth()" id="mainBtn">အကောင့်ဝင်မည်</button>
        <p id="toggleBtn" onclick="toggleMode()" style="color:#0084ff; cursor:pointer; font-size:13px; margin-top:15px;">အကောင့်အသစ်ဖွင့်ရန် နှိပ်ပါ</p>
    </div>

    <div id="chat-section" style="display:none;">
        <h3 style="color:#0084ff;">First Arakha Chat</h3>
        <div id="messages"></div>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="msgInput" placeholder="စာရိုက်ပါ..." style="margin:0;">
            <button onclick="sendMessage()" style="width: 70px;">ပို့</button>
        </div>
        <button onclick="firebase.auth().signOut()" style="background:#ff4444; margin-top:10px; font-size: 12px;">ထွက်မည်</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        storageBucket: "firstarakha.firebasestorage.app",
        messagingSenderId: "4263070909",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let isLoginMode = true;

    window.toggleMode = function() {
        isLoginMode = !isLoginMode;
        document.getElementById('title').innerText = isLoginMode ? "အကောင့်ဝင်ပါ" : "အကောင့်အသစ်ဖွင့်ပါ";
        document.getElementById('mainBtn').innerText = isLoginMode ? "အကောင့်ဝင်မည်" : "စာရင်းသွင်းမည်";
        document.getElementById('toggleBtn').innerText = isLoginMode ? "အကောင့်အသစ်ဖွင့်ရန် နှိပ်ပါ" : "အကောင့်ရှိပြီးသားလား? ဝင်လိုက်ပါ";
    };

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('chat-section').style.display = 'block';
            loadMessages();
        } else {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('chat-section').style.display = 'none';
        }
    });

    window.handleAuth = function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if(!email || !password) return alert("ဖြည့်ဦးလေ ကိုကိုရယ်!");


if (isLoginMode) {
            auth.signInWithEmailAndPassword(email, password).catch(err => alert("အမှား: " + err.message));
        } else {
            auth.createUserWithEmailAndPassword(email, password).catch(err => alert("အမှား: " + err.message));
        }
    };

    window.sendMessage = function() {
        const msgText = document.getElementById('msgInput').value;
        const user = auth.currentUser;
        if (msgText && user) {
            db.ref("global_messages").push({
                sender: user.email.split('@')[0],
                text: msgText,
                time: Date.now()
            });
            document.getElementById('msgInput').value = "";
        }
    };

    function loadMessages() {
        const msgBox = document.getElementById('messages');
        db.ref("global_messages").limitToLast(50).on("child_added", snap => {
            const data = snap.val();
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = <b>${data.sender}</b>: ${data.text};
            msgBox.appendChild(div);
            msgBox.scrollTop = msgBox.scrollHeight;
        });
    }
</script>
</body>
</html>
