<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff41">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
  }
</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Tech Amateurs - Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        #matrixCanvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; 
            background-color: black;
        }
        body { 
            background: #050505; color: #00ff41; 
            font-family: 'Courier New', monospace; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; margin: 0; flex-direction: column; 
        }
        .card { 
            background: rgba(10, 10, 10, 0.9); 
            padding: 30px; border: 1px solid #00ff41; 
            box-shadow: 0 0 15px #00ff4133; 
            width: 320px; text-align: center; border-radius: 8px;
            backdrop-filter: blur(5px);
        }
        /* Input & Button Styles Optimized */
        input { 
            width: 100%; background: #000; border: 1px solid #333; 
            color: #00ff41; padding: 12px; margin-bottom: 15px; 
            outline: none; box-sizing: border-box; border-radius: 4px;
        }
        input:focus { border-color: #00ff41; box-shadow: 0 0 5px #00ff41; }
        
        button { 
            width: 100%; background: #00ff41; color: #000; 
            border: none; padding: 12px; cursor: pointer; 
            font-weight: bold; transition: 0.3s; border-radius: 4px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        button:hover { background: #00cc33; box-shadow: 0 0 15px #00ff41; }
        
        .toggle { font-size: 12px; color: #888; cursor: pointer; margin-top: 15px; display: block; }
        .toggle:hover { color: #00ff41; text-decoration: underline; }
        
        .flag-container { margin-bottom: 20px; }
        .flag-img { width: 100px; height: auto; filter: drop-shadow(0 0 10px rgba(0, 255, 65, 0.3)); }
    </style>
</head>
<body>
    <canvas id="matrixCanvas"></canvas>
    
    <div class="flag-container">
        <img src="homeflag.svg" alt="Flag" class="flag-img">
    </div>

    <div class="card">
        <h2 id="form-title" style="margin-bottom: 5px;">သာလီစွပါ</h2>
        <p id="form-sub-title" style="margin-top: 0; font-size: 14px; color: #888;">..အာရက္ခလူငယ်နည်းပညာဖိုရမ်..</p>
        
        <div id="reg-fields" style="display:none;">
            <input type="text" id="username" placeholder="USER_NAME">
        </div>
        <input type="email" id="email" placeholder="EMAIL_ADDRESS">
        <input type="password" id="pass" placeholder="PASSWORD">
        
        <button onclick="handleAuth()" id="main-btn">LOGIN</button>
        <span class="toggle" onclick="toggleForm()" id="toggle-text">အကောင့်အသစ်ဖွင့်ဖို့ယာလား?</span>
    </div>

    <div style="font-size: 11px; color: #555; margin-top: 20px; letter-spacing: 1px;">
        TOTAL_USERS_REGISTERED: <span id="total-users" style="color: #00ff41;">0</span>
    </div>
    <div id="installContainer" style="display: none; text-align: center; padding: 10px; background: #111; border: 1px solid #00ff41; margin: 10px; border-radius: 8px;">
    <p style="color: #00ff41; margin-bottom: 8px; font-size: 14px;">App အဖြစ် သုံးချင်ပါသလား?</p>
    <button id="installBtn" style="background: #00ff41; color: #000; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">Install Now</button>
</div>

<script>
    // --- Firebase Init ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow", 
        authDomain: "firstarakha.firebaseapp.com",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "firstarakha",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    let isRegister = false;

    // --- Auth Logic ---
    function toggleForm() {
        isRegister = !isRegister;
        document.getElementById('reg-fields').style.display = isRegister ? 'block' : 'none';
        document.getElementById('form-title').innerText = isRegister ? 'REGISTER' : 'သာလီစွပါ';
        document.getElementById('main-btn').innerText = isRegister ? 'SIGN UP' : 'LOGIN';
        document.getElementById('toggle-text').innerText = isRegister ? 'အကောင့်ဟိပြီးသားလား? ဝင်ပါ' : 'အကောင့်အသစ်ဖွင့်ဖို့ယာလား?';
    }

    function handleAuth() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('pass').value;
        const u = document.getElementById('username').value;

        if (isRegister) {
            if(!u || !e || !p) return alert("အချက်အလက်အားလုံး ဖြည့်စွက်ပါ!");
            firebase.auth().createUserWithEmailAndPassword(e, p).then((res) => {
                db.ref('users/' + res.user.uid).set({ username: u, email: e });
                window.location.href = "forum.html";
            }).catch(err => alert(err.message));
        } else {
            if(!e || !p) return alert("Email နှင့် Password ဖြည့်ပါ!");
            firebase.auth().signInWithEmailAndPassword(e, p).then(() => {
                window.location.href = "forum.html";
            }).catch(err => alert(err.message));
        }
    }

    // Auto Redirect if logged in
    firebase.auth().onAuthStateChanged(user => { if(user) window.location.href = "forum.html"; });

    // Count Users
    db.ref('users').on('value', s => {
        document.getElementById('total-users').innerText = s.numChildren() || 0;
    });

    // --- Matrix Animation ---
    const canvas = document.getElementById('matrixCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const letters = "ARAKHA010101";
    const fontSize = 16;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);

    function drawMatrix() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#0F0";
        ctx.font = fontSize + "px monospace";
        for (let i = 0; i < drops.length; i++) {
            const text = letters.charAt(Math.floor(Math.random() * letters.length));
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }
    setInterval(drawMatrix, 40);
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    });
    let deferredPrompt;
const installContainer = document.getElementById('installContainer');
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e) => {
    // Browser ရဲ့ default pop-up ကို ခဏတားထားမယ်
    e.preventDefault();
    deferredPrompt = e;
    // ကိုယ်တိုင်လုပ်ထားတဲ့ Install ခလုတ်လေးကို ပြပေးမယ်
    installContainer.style.display = 'block';
});

installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
        // Install လုပ်မလားလို့ မေးမယ်
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response: ${outcome}`);
        // တစ်ခါနှိပ်ပြီးရင် ခလုတ်ကို ပြန်ဖျောက်မယ်
        deferredPrompt = null;
        installContainer.style.display = 'none';
    }
});

// App ကို install လုပ်ပြီးသွားရင် ခလုတ်ကို အပြီးဖျောက်လိုက်မယ်
window.addEventListener('appinstalled', () => {
    installContainer.style.display = 'none';
    console.log('App was installed');
});
</script>
</body>
</html>
