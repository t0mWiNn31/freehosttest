<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { background: #0a0a0a; color: #ccc; font-family: sans-serif; margin: 0; }
        .nav { background: #111; padding: 15px; border-bottom: 1px solid #00ff41; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 700px; margin: 20px auto; padding: 10px; }
        .post-input { background: #111; padding: 20px; border: 1px solid #333; margin-bottom: 20px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 10px; margin-top: 10px; outline: none; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .card { background: #161616; padding: 15px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #222; }
        .user { color: #00ff41; font-weight: bold; font-size: 13px; }
        .title { font-size: 18px; color: #fff; margin: 10px 0; }
        .action-bar { border-top: 1px solid #222; padding-top: 10px; display: flex; gap: 20px; font-size: 13px; }
        .like-btn { cursor: pointer; color: #00ff41; }
    </style>
</head>
<body>

<div class="nav">
    <b style="color:#00ff41">ARAKHA_FORUM</b>
    <div style="font-size: 11px; display: flex; gap: 15px;">
        <span>ONLINE: <b id="online-count" style="color:#00ff41">0</b></span>
        <span>TOTAL: <b id="total-count" style="color:#00ff41">0</b></span>
    </div>
    <button onclick="logout()">LOGOUT</button>
</div>

<div class="container">
    <div class="post-input">
        <h3 style="margin:0; color:#00ff41">·Äõ·ÄÄ·Äπ·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ä¨·Ä∏·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·Äï·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·ÄΩ·ÄÑ·Ä∑·Ä∫·Äú·ÄÑ·Ä∫·Ä∏·Äú·ÄÑ·Ä∫·Ä∏·ÄÜ·ÄΩ·Ä±·Ä∏·Äî·ÄΩ·Ä±·Ä∏·ÄÄ·Äê·Ä∫·Äô·Ä±</h3>
        <input type="text" id="t" placeholder="·ÄÇ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫">
        <textarea id="c" rows="3" placeholder="·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨..."></textarea>
        <button onclick="post()">POST ·Äê·ÄÑ·Ä∫·Äô·Ä±</button>
    </div>
    <div id="feed"></div>
</div>
   

<script>
    // ·ÅÅ·Åã Firebase Configuration
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    let currentUsername = "";

    // ·ÅÇ·Åã User ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä±·ÄÄ·Ä≠·ÄØ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    firebase.auth().onAuthStateChanged(user => {
        if (!user) {
            window.location.href = "index.html";
        } else {
            // User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äö·Ä∞·Äï·Äº·ÄÆ·Ä∏ Presence ·ÄÖ·Äê·ÄÑ·Ä∫·Äô·Äö·Ä∫
            db.ref('users/' + user.uid).once('value', s => {
                currentUsername = s.val() ? s.val().username : user.email.split('@')[0];
                document.getElementById('user-display').innerText = "User: " + currentUsername;
                
                trackPresence(user); // Online ·Äú·Ä∞·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·Äê·Ä∫·Äõ·Äî·Ä∫
                load(); // ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÜ·ÄΩ·Ä≤·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫
            });
        }
    });

    // ·ÅÉ·Åã Online/Total Count ·ÄÖ·Äî·ÄÖ·Ä∫
    function trackPresence(user) {
        const onlineRef = db.ref('online/' + user.uid);
        onlineRef.set(true);
        onlineRef.onDisconnect().remove();

        // ·Ä°·Äõ·Ä±·Ä°·Äê·ÄΩ·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ Real-time ·Äï·Äº·Äû·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
        db.ref('online').on('value', s => {
            const count = s.numChildren();
            if(document.getElementById('online-count')) document.getElementById('online-count').innerText = count;
        });
        db.ref('users').on('value', s => {
            const total = s.numChildren();
            if(document.getElementById('total-count')) document.getElementById('total-count').innerText = total;
        });
    }

    // ·ÅÑ·Åã Gemini AI Function
    async function askGemini(question) {
        const KEY = "YOUR_GEMINI_API_KEY"; // ·ÄÄ·Ä≠·ÄØ·ÄÄ·Ä≠·ÄØ·Ä∑ Key ·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äô·Äæ·Ä¨·Äë·Ää·Ä∑·Ä∫·Äï·Ä´
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`;
        try {
            const res = await fetch(url, { 
                method: "POST", 
                headers: { "Content-Type": "application/json" }, 
                body: JSON.stringify({ contents: [{ parts: [{ text: "·Äô·ÄÑ·Ä∫·Ä∏·ÄÄ ·Äî·Ää·Ä∫·Ä∏·Äï·Ää·Ä¨·Ä°·ÄÄ·Äº·Ä∂·Äï·Ä±·Ä∏ AI ·Äñ·Äº·ÄÖ·Ä∫·Äê·Äö·Ä∫·Åã ·Äô·Äº·Äî·Ä∫·Äô·Ä¨·Äú·Ä≠·ÄØ·Äï·Ä≤ ·Äê·Ä≠·ÄØ·Äê·Ä≠·ÄØ·Äî·Ä≤·Ä∑ ·Äú·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ä±·Äï·Ä±·Ä∏·Äï·Ä´·Åã ·Äô·Ä±·Ä∏·ÄÅ·ÄΩ·Äî·Ä∫·Ä∏·ÄÄ- " + question }] }] }) 
            });
            const d = await res.json();
            return d.candidates[0].content.parts[0].text;
        } catch (e) { 
            return "Gemini ·ÄÅ·Äè·Äî·Ä¨·Ä∏·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫ ·ÄÄ·Ä≠·ÄØ·ÄÄ·Ä≠·ÄØ..."; 
        }
    }

    // ·ÅÖ·Åã Post ·Äê·ÄÑ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    async function post() {
        const t = document.getElementById('t').value, c = document.getElementById('c').value;
        if(t && c) {
            // AI ·Ä°·Äñ·Äº·Ä±·ÄÄ·Ä≠·ÄØ ·Äê·ÄÖ·Ä∫·ÄÅ·Ä´·Äê·Ää·Ä∫·Ä∏ ·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äô·Äö·Ä∫
            const aiReply = await askGemini(c);
            db.ref("posts").push({ 
                u: currentUsername, 
                t: t, 
                c: c, 
                ai: aiReply, 
                time: Date.now(),
                likes: 0 
            });
            document.getElementById('t').value = ""; 
            document.getElementById('c').value = "";
        }
    }

    // ·ÅÜ·Åã ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äû·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    function load() {
        db.ref("posts").orderByChild("time").on("value", s => {
            const feed = document.getElementById('feed'); 
            feed.innerHTML = "";
            let items = []; 
            s.forEach(child => { items.push({key: child.key, ...child.val()}); });
            
            items.reverse().forEach(p => {
                feed.innerHTML += `
                <div class="card" style="background:#161616; padding:20px; border-radius:8px; margin-bottom:15px; border:1px solid #222;">
                    <div class="user" style="color:#00ff41; font-size:12px;">@${p.u}</div>
                    <div class="title" style="font-size:18px; color:#fff; margin:10px 0;">${p.t}</div>
                    <p style="font-size:14px; color:#ccc;">${p.c}</p>
                    <div class="ai-box" style="background:rgba(0,255,65,0.05); border:1px dashed #00ff41; padding:10px; margin-top:10px; font-size:13px;">
                        <b style="color:#00ff41">ü§ñ Gemini AI:</b><br>${p.ai}
                    </div>
                </div>`;
            });
        });
    }

    // ·Åá·Åã Logout Function (·ÄÄ·Ä≠·ÄØ·ÄÄ·Ä≠·ÄØ·Ä∑ error ·Äê·ÄÄ·Ä∫·Äî·Ä±·Äê·Ä≤·Ä∑ ·Ä°·Äï·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏)
    function logout() {
        if (confirm("·Äú·Ä¨·Ä∏·Äï·Ä´·Äñ·Ä≠·ÄØ·Ä∑·Äö·Ä¨·Äú·Ä¨·Ä∏?")) {
            firebase.auth().signOut().then(() => {
                window.location.href = "index.html";
            });
        }
    }
</script>
</body>
</html>
