<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { background: #0a0a0a; color: #ccc; font-family: sans-serif; margin: 0; }
        .nav { background: #111; padding: 10px 15px; border-bottom: 1px solid #00ff41; position: sticky; top: 0; z-index: 100; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .nav-tabs { display: flex; gap: 20px; border-top: 1px solid #222; padding-top: 8px; }
        .tab { font-size: 13px; color: #888; cursor: pointer; padding: 5px 0; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab.active { color: #00ff41; border-bottom: 2px solid #00ff41; }
        
        .container { max-width: 700px; margin: 20px auto; padding: 10px; }
        .post-input { background: #111; padding: 20px; border: 1px solid #333; margin-bottom: 20px; border-radius: 8px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 12px; margin-top: 10px; outline: none; box-sizing: border-box; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; margin-top: 10px; border-radius: 4px; }
        
        .card { background: #161616; padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; animation: fadeIn 0.5s; }
        .user { color: #00ff41; font-weight: bold; font-size: 12px; }
        .title { font-size: 18px; color: #fff; margin: 10px 0; }
        .ai-box { background: rgba(0, 255, 65, 0.05); border: 1px dashed #00ff41; padding: 12px; margin-top: 15px; font-size: 13px; border-radius: 4px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-top">
        <div>
            <b style="color:#00ff41">ARAKHA_FORUM</b>
            <div style="font-size: 10px; color: #666;">ONLINE: <span id="online-count">0</span> | TOTAL: <span id="total-count">0</span></div>
        </div>
        <div id="user-display" style="font-size: 12px; color: #00ff41;"></div>
        <button onclick="logout()" style="background:#ff4444; color:#fff; padding:5px 10px; margin:0; font-size: 11px;">LOGOUT</button>
    </div>
    
    <div class="nav-tabs">
        <div class="tab active" id="tab-latest" onclick="switchTab('latest')">·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·Äê·ÄÑ·Ä∫·ÄÅ·Ä≤·Ä∑·Äê·Ä¨</div>
        <div class="tab" id="tab-popular" onclick="switchTab('popular')">·Äî·Ä¨·Äô·Ää·Ä∫·ÄÄ·Äº·ÄÆ·Ä∏ (Popular)</div>
    </div>
</div>

<div class="container">
    <div class="post-input">
        <h3 style="margin:0; color:#00ff41">·Äõ·ÄÄ·Äπ·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ä¨·Ä∏·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·Äï·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·ÄΩ·ÄÑ·Ä∑·Ä∫·Äú·ÄÑ·Ä∫·Ä∏·Äú·ÄÑ·Ä∫·Ä∏·ÄÜ·ÄΩ·Ä±·Ä∏·Äî·ÄΩ·Ä±·Ä∏·ÄÄ·Äê·Ä∫·Äô·Ä±</h3>
        <input type="text" id="t" placeholder="·ÄÇ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫">
        <textarea id="c" rows="3" placeholder="·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨..."></textarea>
        <button id="post-btn" onclick="post()">POST ·Äê·ÄÑ·Ä∫·Äô·Ä±</button>
    </div>
    <div id="feed"></div>
</div>

<script>
    // --- (·ÅÅ) FIREBASE CONFIG ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    let currentUsername = "";
    let currentTab = 'latest';

    // --- (·ÅÇ) ·Äó·Äª·Ä¨·Äú·Ä∫ (BYAL) AI FUNCTION ---
    async function askGemini(question) {
        // ·Ä°·Äõ·Ä±·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏ - ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨ ·ÄÄ·Ä≠·ÄØ·ÄÄ·Ä≠·ÄØ·Ä∑·Äõ·Ä≤·Ä∑ Gemini API Key ·ÄÄ·Ä≠·ÄØ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´
        const GEMINI_API_KEY = "·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨_·ÄÄ·Ä≠·ÄØ·ÄÄ·Ä≠·ÄØ·Ä∑_KEY_·Äë·Ää·Ä∑·Ä∫·Äï·Ä´"; 
        
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;

        try {
            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "·Äô·ÄÑ·Ä∫·Ä∏·Äõ·Ä≤·Ä∑·Äî·Ä¨·Äô·Ää·Ä∫·ÄÄ '·Äó·Äª·Ä¨·Äú·Ä∫ (Byal)' ·Äñ·Äº·ÄÖ·Ä∫·Äê·Äö·Ä∫·Åã ·Äô·ÄÑ·Ä∫·Ä∏·ÄÄ ·Äõ·ÄÄ·Äπ·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Äî·Ää·Ä∫·Ä∏·Äï·Ää·Ä¨·Äñ·Ä≠·ÄØ·Äõ·Äô·Ä∫·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·Äõ·Ä≤·Ä∑ ·Ä°·Äû·Ä≠·Äâ·Ä¨·Äè·Ä∫·ÄÄ·Äº·ÄÆ·Ä∏·Äô·Ä¨·Ä∏·Äê·Ä≤·Ä∑ AI ·Äê·ÄÖ·Ä∫·Ä¶·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äê·Äö·Ä∫·Åã ·Äô·Äº·Äî·Ä∫·Äô·Ä¨·Äú·Ä≠·ÄØ·Äï·Ä≤ ·Äê·Ä≠·ÄØ·Äê·Ä≠·ÄØ·Äî·Ä≤·Ä∑ ·Äú·Ä≠·ÄØ·Äõ·ÄÑ·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ä±·Äï·Ä±·Ä∏·Äï·Ä´·Åã ·Äô·Ä±·Ä∏·ÄÅ·ÄΩ·Äî·Ä∫·Ä∏·ÄÄ - " + question }] }]
                })
            });
            const data = await res.json();
            return data.candidates[0].content.parts[0].text;
        } catch (e) {
            return "·Äó·Äª·Ä¨·Äú·Ä∫ ·Ä°·ÄÅ·ÄØ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ ·Ä°·Äî·Ä¨·Ä∏·Äö·Ä∞·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫·ÄÅ·ÄÑ·Ä∫·Äó·Äª·Ä¨·Åã";
        }
    }

    // --- (·ÅÉ) POST ·Äê·ÄÑ·Ä∫·Äû·Ää·Ä∑·Ä∫·ÄÖ·Äî·ÄÖ·Ä∫ ---
    async function post() {
        const t = document.getElementById('t').value, c = document.getElementById('c').value;
        const btn = document.getElementById('post-btn');

        if(t && c) {
            btn.innerText = "·Äó·Äª·Ä¨·Äú·Ä∫ ·ÄÖ·Äâ·Ä∫·Ä∏·ÄÖ·Ä¨·Ä∏·Äî·Ä±·Äû·Ää·Ä∫...";
            btn.disabled = true;

            const aiResponse = await askGemini(c); 

            db.ref("posts").push({ 
                u: currentUsername, t: t, c: c, 
                ai: aiResponse, 
                time: Date.now(),
                views: Math.floor(Math.random() * 10) // Popular ·ÄÖ·Äô·Ä∫·Ä∏·Äû·Äï·Ä∫·Äõ·Äî·Ä∫ view ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÑ·Äö·Ä∫ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
            });

            document.getElementById('t').value = ""; 
            document.getElementById('c').value = "";
            btn.innerText = "POST ·Äê·ÄÑ·Ä∫·Äô·Ä±";
            btn.disabled = false;
        }
    }

    // --- (·ÅÑ) ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏·Äï·Äº·Äû·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ---
    function load() {
        db.ref("posts").on("value", s => {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            let items = [];
            s.forEach(child => { items.push({ key: child.key, ...child.val() }); });

            // Tab ·Ä°·Äú·Ä≠·ÄØ·ÄÄ·Ä∫ Sort ·Äú·ÄØ·Äï·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
            if (currentTab === 'latest') {
                items.reverse();
            } else {
                items.sort((a, b) => (b.views || 0) - (a.views || 0));
            }

            items.forEach(p => {
                const card = document.createElement('div');
                card.className = "card";
                card.innerHTML = `
                    <div class="user">@${p.u || 'Unknown'}</div>
                    <div class="title">${p.t || 'No Title'}</div>
                    <p style="font-size:14px; color:#ccc; line-height:1.6;">${p.c || ''}</p>
                    <div class="ai-box">
                        <b style="color:#00ff41">ü§ñ ·Äó·Äª·Ä¨·Äú·Ä∫ (Byal):</b><br>
                        <span style="display:block; margin-top:5px;">${p.ai}</span>
                    </div>
                `;
                feed.appendChild(card);
            });
        });
    }

    // --- (·ÅÖ) USER ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä± ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÄ·Äº·Ää·Ä∑·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ---
    firebase.auth().onAuthStateChanged(user => {
        if (!user) { window.location.href = "index.html"; } 
        else {
            db.ref('users/' + user.uid).once('value', s => {
                currentUsername = s.val() ? s.val().username : user.email.split('@')[0];
                const display = document.getElementById('user-display');
                if(display) display.innerText = "·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞ - " + currentUsername;
                trackPresence(user);
                load();
            });
        }
    });

    function trackPresence(user) {
        const onlineRef = db.ref('online/' + user.uid);
        onlineRef.set(true);
        onlineRef.onDisconnect().remove();
        db.ref('online').on('value', s => { document.getElementById('online-count').innerText = s.numChildren(); });
        db.ref('users').on('value', s => { document.getElementById('total-count').innerText = s.numChildren(); });
    }

    function switchTab(tab) {
        currentTab = tab;
        document.getElementById('tab-latest').classList.remove('active');
        document.getElementById('tab-popular').classList.remove('active');
        document.getElementById('tab-' + tab).classList.add('active');
        load();
    }

    function logout() {
        if (confirm("·Äú·Ä¨·Ä∏·Äï·Ä´·Äñ·Ä≠·ÄØ·Ä∑·Äö·Ä¨·Äú·Ä¨·Ä∏?")) {
            firebase.auth().signOut().then(() => { window.location.href = "index.html"; });
        }
    }
</script>
</body>
</html>
