<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        body { background: #000; color: #ccc; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Glassmorphism Navigation */
        /* Navigation ·Äï·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Ä°·Äê·ÄΩ·ÄÄ·Ä∫·Äï·Ä´ ·Ää·Äæ·Ä≠·Äë·Ä¨·Ä∏·Äê·Ä≤·Ä∑ CSS */
.nav { 
    background: rgba(17, 17, 17, 0.9); 
    backdrop-filter: blur(10px); 
    padding: 10px; 
    border-bottom: 1px solid #00ff41; 
    position: sticky; top: 0; z-index: 100; 
}
.nav-top { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 10px; 
}
.nav-right {
    display: flex; 
    flex-direction: column; 
    align-items: flex-end; 
    gap: 5px;
}
.nav-tabs { display: flex; gap: 15px; border-top: 1px solid #222; padding-top: 8px; }
.tab { font-size: 12px; color: #888; cursor: pointer; padding: 5px 0; }
.tab.active { color: #00ff41; border-bottom: 2px solid #00ff41; }

/* ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Äû·ÄÆ·Ä∏·Äû·Äî·Ä∑·Ä∫ (Mobile Fix) */
@media (max-width: 480px) {
    b { font-size: 13px; }
    #user-display { font-size: 10px; }
    .nav-tabs { gap: 10px; }
    .tab { font-size: 11px; }
    button { padding: 4px 8px !important; font-size: 9px !important; }
}
      

        .container { max-width: 700px; margin: 20px auto; padding: 10px; position: relative; z-index: 1; }
        
        /* Post Input Box */
        .post-input { background: rgba(17, 17, 17, 0.85); padding: 25px; border: 1px solid #00ff41; margin-bottom: 20px; border-radius: 12px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #00ff41; padding: 12px; margin-top: 10px; outline: none; box-sizing: border-box; border-radius: 4px; }
        button { background: #00ff41; color: #000; border: none; padding: 12px; cursor: pointer; font-weight: bold; margin-top: 15px; border-radius: 4px; transition: 0.3s; }
        button:hover { background: #00cc33; }
        
        /* Cards */
        .card { background: rgba(22, 22, 22, 0.9); padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; backdrop-filter: blur(5px); }
        .user { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .user a { color: #00ff41; font-weight: bold; font-size: 15px; text-decoration: none; }
        .avatar { font-size: 25px; background: #111; border-radius: 50%; width: 40px; height: 40px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; }
        .reply-box { margin-top: 10px; padding-left: 15px; border-left: 2px solid #00ff41; font-size: 13px; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="nav">
    <div class="nav-top" style="display: flex; justify-content: space-between; align-items: center;">
        
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 35px; height: 35px; background: #111; border: 1px solid #00ff41; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                üÖ∞Ô∏è
            </div>
            
            <div>
                <b style="color:#00ff41; display: block; line-height: 1; font-size: 14px;">ARAKHA_FORUM</b>
                <div style="font-size: 9px; color: #666; margin-top: 3px;">
                    ON: <span id="online-count">0</span> | TOT: <span id="total-count">0</span>
                </div>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 5px;">
            <div id="user-display" style="color: #00ff41; font-weight: bold; font-size: 10px; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                </div>
            <div style="display: flex; gap: 5px;">
                <button onclick="goToProfile()" style="background:transparent; border:1px solid #00ff41; color:#00ff41; padding:4px 8px; font-size: 9px; cursor: pointer; border-radius: 4px;">PROFILE</button>
                <button onclick="logout()" style="background:#ff4444; color:#fff; border:none; padding:4px 8px; font-size: 9px; cursor: pointer; border-radius: 4px;">LOGOUT</button>
            </div>
        </div>
    </div>

    <div class="nav-tabs" style="display: flex; gap: 15px; border-top: 1px solid #222; padding-top: 8px; margin-top: 10px;">
        <div class="tab active" id="tab-latest" onclick="switchTab('latest')">·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·Äê·ÄÑ·Ä∫·ÄÅ·ÄÖ·Ä¨</div>
        <div class="tab" id="tab-popular" onclick="switchTab('popular')">·Äî·Ä¨·Äô·Ää·Ä∫·ÄÄ·Äº·ÄÆ·Ä∏</div>
    </div>
</div>
<div class="container">
    <div class="post-input">
        <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: #00ff41; font-size: 20px;">·Äõ·ÄÄ·Äπ·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ä¨·Ä∏·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·ÄÜ·ÄΩ·Ä±·Ä∏·Äî·ÄΩ·Ä±·Ä∏·ÄÄ·Äê·Ä∫·Äô·Ä±</h2>
            <p style="margin: 5px 0 0 0; color: #aaa; font-size: 14px;">...·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·ÄÖ·Ä¨·Äê·Ä≠·Äü·Ä≠·ÄÄ·Ä± ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äú·Ä≠·ÄØ·Ä∑ ·Ä°·ÄÄ·Äº·Ä∂·Äï·Äº·ÄØ·ÄÅ·ÄÄ·Äê·Ä∫·Äï·Ä´...</p>
        </div>
        
        <input type="text" id="t" placeholder="·ÄÇ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫ (Title)">
        <textarea id="c" rows="3" placeholder="·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨..."></textarea>
        <button onclick="post()" style="width: 100%;">POST ·Äê·ÄÑ·Ä∫·Äô·Ä±</button>
    </div>
    <div id="feed"></div>
</div>

<script>
    // --- 1. Security Logic (Malicious Script ·Äê·Ä¨·Ä∏·ÄÜ·ÄÆ·Ä∏·Äõ·Äî·Ä∫) ---
    function escapeHTML(str) {
        if (!str) return "";
        return str.replace(/[&<>"']/g, function(m) {
            return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m];
        });
    }
    function goToProfile() {
    const user = firebase.auth().currentUser;
    if(user) {
        // ·Äô·Ä≠·Äô·Ä≠·Äõ·Ä≤·Ä∑ UID ·ÄÄ·Ä≠·ÄØ ·Äï·Ä´·Äõ·Ä¨·Äô·ÄÆ·Äê·Ä¨·Ä°·Äî·Ä±·Äî·Ä≤·Ä∑ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏ profile.html ·ÄÄ·Ä≠·ÄØ ·Äû·ÄΩ·Ä¨·Ä∏·Äô·Äö·Ä∫
        window.location.href = "profile.html?id=" + user.uid;
    }
}

    // --- 2. Matrix Background ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const matrixText = "ARAKHA010101";
    const fontSize = 16;
    const drops = Array(Math.floor(canvas.width / fontSize)).fill(1);

    function drawMatrix() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00ff41";
        ctx.font = fontSize + "px monospace";
        drops.forEach((y, i) => {
            const char = matrixText[Math.floor(Math.random() * matrixText.length)];
            ctx.fillText(char, i * fontSize, y * fontSize);
            if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        });
    }
    setInterval(drawMatrix, 50);

    // --- 3. Firebase Implementation ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let userDataCache = {};
    let postsData = [];
    let currentTab = 'latest';

    // Users Data ·ÄÄ·Ä≠·ÄØ ·Ä°·Äô·Äº·Ä≤ Watch ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫ (Real-time Name Update)
    db.ref('users').on('value', snap => {
        userDataCache = snap.val() || {};
        renderFeed();
    });

    // Posts ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ Watch ·Äú·ÄØ·Äï·Ä∫·Äô·Äö·Ä∫
    db.ref('posts').on('value', snap => {
        postsData = [];
        snap.forEach(child => { postsData.push({ key: child.key, ...child.val() }); });
        renderFeed();
    });

    function renderFeed() {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        
        let items = [...postsData];
        if (currentTab === 'latest') items.reverse();
        else items.sort((a, b) => (b.likes || 0) - (a.likes || 0));

        items.forEach(p => {
            const user = userDataCache[p.uid] || {};
            const name = user.username || p.u || "·Ä°·Äô·Ää·Ä∫·Äô·Äû·Ä≠";
            const avatar = user.profilePic || "üë§";

            let repliesHTML = "";
            if (p.replies) {
                Object.values(p.replies).forEach(r => {
                    const rUser = userDataCache[r.uid] || {};
                    repliesHTML += `
                        <div style="margin-top:8px;">
                            <span>${rUser.profilePic || 'üë§'}</span>
                            <a href="profile.html?id=${r.uid}" style="color:#00ff41; text-decoration:none;">@${rUser.username || r.u}:</a> ${r.m}
                        </div>`;
                });
            }

            const card = document.createElement('div');
            card.className = "card";
            card.innerHTML = `
                <div class="user">
                    <div class="avatar">${avatar}</div>
                    <a href="profile.html?id=${p.uid}">@${name}</a>
                </div>
                <div style="color:#fff; font-weight:bold; margin-bottom:5px; font-size:18px;">${p.t}</div>
                <p style="margin:0; font-size:14px; line-height:1.5;">${p.c}</p>
                <div style="margin-top:10px; font-size:12px; display:flex; gap:15px;">
                    <span style="color:#00ff41; cursor:pointer;" onclick="like('${p.key}')">‚ù§Ô∏è Like (${p.likes || 0})</span>
                    <span style="color:#888; cursor:pointer;" onclick="reply('${p.key}')">üí¨ Reply</span>
                </div>
                <div class="reply-box">${repliesHTML}</div>`;
            feed.appendChild(card);
        });
    }

    async function post() {
        const t = document.getElementById('t').value;
        const c = document.getElementById('c').value;
        const user = firebase.auth().currentUser;
        if(t && c && user) {
            // HTML Escape ·Äú·ÄØ·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äô·Äæ Database ·Äû·Ä≠·ÄØ·Ä∑·Äï·Ä≠·ÄØ·Ä∑·Äô·Ää·Ä∫
            db.ref("posts").push({
                uid: user.uid,
                u: user.email.split('@')[0], 
                t: escapeHTML(t),
                c: escapeHTML(c),
                time: Date.now(),
                likes: 0
            });
            document.getElementById('t').value = ""; document.getElementById('c').value = "";
        }
    }

    function reply(id) {
        const m = prompt("Reply ·Äï·Äº·Äî·Ä∫·Äô·Ä± -");
        const user = firebase.auth().currentUser;
        if(m && user) {
            db.ref(`posts/${id}/replies`).push({
                uid: user.uid,
                u: user.email.split('@')[0],
                m: escapeHTML(m)
            });
        }
    }

    function like(id) { db.ref(`posts/${id}/likes`).transaction(c => (c || 0) + 1); }

    function switchTab(t) {
        currentTab = t;
        document.getElementById('tab-latest').classList.toggle('active', t==='latest');
        document.getElementById('tab-popular').classList.toggle('active', t==='popular');
        renderFeed();
    }

    firebase.auth().onAuthStateChanged(user => {
        if (!user) window.location.href = "index.html";
        else {
            db.ref('users/' + user.uid).on('value', s => {
                const data = s.val() || {};
                document.getElementById('user-display').innerText = "·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞ - " + (data.username || user.email.split('@')[0]);
            });
            const onlineRef = db.ref('online/' + user.uid);
            onlineRef.set(true); onlineRef.onDisconnect().remove();
        }
    });

    db.ref('online').on('value', s => { document.getElementById('online-count').innerText = s.numChildren(); });
    db.ref('users').on('value', s => { document.getElementById('total-count').innerText = s.numChildren(); });

    function logout() { 
        if (confirm("·Äú·Ä¨·Ä∏·Äï·Ä´·Äñ·Ä≠·ÄØ·Ä∑·Äö·Ä¨·Äú·Ä¨·Ä∏?(·Ä°·Ä¨·Ä∏·ÄÄ·Ä±·Äú·Ä¨·Äú·Ää·Ä∫·Äï·Ä´)")) {
            firebase.auth().signOut().then(() => window.location.href = "index.html");
        } 
    }
</script>
</body>
</html>
