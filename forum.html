<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        /* Matrix Background */
        #matrix-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }

        body { background: #000; color: #ccc; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Glassmorphism Navigation */
        .nav { 
            background: rgba(17, 17, 17, 0.9); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px 15px; 
            border-bottom: 1px solid #00ff41; 
            position: sticky; top: 0; z-index: 100; 
        }
        .nav-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .nav-tabs { display: flex; gap: 20px; border-top: 1px solid #222; padding-top: 8px; }
        .tab { font-size: 13px; color: #888; cursor: pointer; padding: 5px 0; border-bottom: 2px solid transparent; }
        .tab.active { color: #00ff41; border-bottom: 2px solid #00ff41; }

        .container { max-width: 700px; margin: 20px auto; padding: 10px; position: relative; z-index: 1; }
        
        .post-input { 
            background: rgba(17, 17, 17, 0.85); 
            padding: 20px; border: 1px solid #00ff41; 
            margin-bottom: 20px; border-radius: 8px; 
        }
        input, textarea { 
            width: 100%; background: #000; border: 1px solid #444; color: #00ff41; 
            padding: 12px; margin-top: 10px; outline: none; box-sizing: border-box; 
        }
        input:focus, textarea:focus { border-color: #00ff41; }
        
        button { 
            background: #00ff41; color: #000; border: none; 
            padding: 10px 15px; cursor: pointer; font-weight: bold; 
            margin-top: 10px; border-radius: 4px; 
        }
        
        .card { 
            background: rgba(22, 22, 22, 0.9); 
            padding: 20px; border-radius: 8px; margin-bottom: 15px; 
            border: 1px solid #222; backdrop-filter: blur(5px);
        }
        .card:hover { border-color: #00ff41; box-shadow: 0 0 10px rgba(0, 255, 65, 0.1); }
        
        .user { display: flex; align-items: center; gap: 10px; }
        .user a { color: #00ff41; font-weight: bold; font-size: 15px; text-decoration: none; }
        .avatar { 
            font-size: 25px; background: #111; border-radius: 50%; 
            width: 40px; height: 40px; border: 1px solid #333; 
            display: flex; align-items: center; justify-content: center; 
        }
        
        .title { font-size: 18px; color: #fff; margin: 10px 0; font-weight: bold; }
        .action-bar { border-top: 1px solid #222; margin-top: 15px; padding-top: 10px; display: flex; gap: 20px; font-size: 13px; }
        .like-btn { cursor: pointer; color: #00ff41; }
        .reply-box { margin-top: 10px; padding-left: 15px; border-left: 2px solid #00ff41; }
        .ai-box { background: rgba(0, 255, 65, 0.05); border: 1px dashed #00ff41; padding: 12px; margin-top: 15px; font-size: 13px; border-radius: 4px; color: #00ff41; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="nav">
    <div class="nav-top">
        <div>
            <b style="color:#00ff41">ARAKHA_KNOWLEDGE_FORUM</b>
            <div style="font-size: 10px; color: #888;">ONLINE: <span id="online-count">0</span> | TOTAL: <span id="total-count">0</span></div>
        </div>
        <div id="user-display" style="font-size: 12px; color: #00ff41;"></div>
        <button onclick="logout()" style="background:#ff4444; color:#fff; padding:5px 10px; margin:0; font-size: 11px;">LOGOUT</button>
    </div>
    <div class="nav-tabs">
        <div class="tab active" id="tab-latest" onclick="switchTab('latest')">·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·Äê·ÄÑ·Ä∫·ÄÅ·ÄÖ·Ä¨</div>
        <div class="tab" id="tab-popular" onclick="switchTab('popular')">·Äî·Ä¨·Äô·Ää·Ä∫·ÄÄ·Äº·ÄÆ·Ä∏ (Popular)</div>
    </div>
</div>

<div class="container">
    <div class="post-input">
        <h3 style="margin:0; color:#00ff41">·Äõ·ÄÄ·Äπ·ÄÅ·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ä¨·Ä∏·Ä°·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·ÄÜ·ÄΩ·Ä±·Ä∏·Äî·ÄΩ·Ä±·Ä∏·ÄÄ·Äê·Ä∫·Äô·Ä±</h3>
        <h3 style="margin:0; color:#00ff41">...·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·ÄÖ·Ä±·Ä¨·Ä∫·Äê·Ä≠·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äï·ÄÅ·Äï·Ä´...</h3>
        <input type="text" id="t" placeholder="·ÄÇ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫ (Title)">
        <textarea id="c" rows="3" placeholder="·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨..."></textarea>
        <button id="post-btn" onclick="post()">POST ·Äê·ÄÑ·Ä∫·Äô·Ä±</button>
    </div>
    <div id="feed"></div>
</div>

<script>
    // --- Matrix Animation ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const matrixText = "ARAKHA010101";
    const fontSize = 16;
    const columns = canvas.width / fontSize;
    const drops = [];
    for (let i = 0; i < columns; i++) drops[i] = 1;

    function drawMatrix() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00ff41";
        ctx.font = fontSize + "px monospace";
        for (let i = 0; i < drops.length; i++) {
            const char = matrixText.charAt(Math.floor(Math.random() * matrixText.length));
            ctx.fillText(char, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }
    setInterval(drawMatrix, 50);

    // --- Firebase Logic ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let currentUsername = "";
    let currentUserAvatar = "üë§";
    let currentTab = 'latest';

    firebase.auth().onAuthStateChanged(user => {
        if (!user) window.location.href = "index.html";
        else {
            // User Data ·ÄÄ·Ä≠·ÄØ Real-time ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äô·Äö·Ä∫
            db.ref('users/' + user.uid).on('value', s => {
                const data = s.val();
                // ·Äî·Ä¨·Äô·Ää·Ä∫·ÄÄ·Ä≠·ÄØ Priority ·ÄÖ·Äâ·Ä∫·Äô·Äö·Ä∫- Database > DisplayName > Email
                currentUsername = (data && data.username) ? data.username : (user.displayName || user.email.split('@')[0]);
                currentUserAvatar = (data && data.profilePic) ? data.profilePic : "üë§";
                
                document.getElementById('user-display').innerText = "·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞ - " + currentUsername;
                trackPresence(user);
                load();
            });
        }
    });

    async function post() {
        const t = document.getElementById('t').value, c = document.getElementById('c').value;
        const user = firebase.auth().currentUser;
        if(t && c && user) {
            db.ref("posts").push({ 
                u: currentUsername, uid: user.uid, avatar: currentUserAvatar,
                t: t, c: c, ai: "·Äó·Äª·Ä¨·Äú·Ä∫ ·ÄÖ·Äâ·Ä∫·Ä∏·ÄÖ·Ä¨·Ä∏·Äî·ÄÆ·Äï·Ä´·Äõ·Ä±...", time: Date.now(), likes: 0 
            });
            document.getElementById('t').value = ""; document.getElementById('c').value = "";
        }
    }

    function reply(id) {
        const rText = prompt("·Äï·Äº·Ä±·Ä¨·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äá·Äô·Ä∫ -");
        const user = firebase.auth().currentUser;
        if(rText && user) {
            db.ref("posts/" + id + "/replies").push({ 
                u: currentUsername, uid: user.uid, avatar: currentUserAvatar, m: rText 
            });
        }
    }

    function like(id) {
        db.ref("posts/" + id + "/likes").transaction(c => (c || 0) + 1);
    }

    function load() {
    db.ref("posts").on("value", s => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        let items = [];
        s.forEach(child => { items.push({ key: child.key, ...child.val() }); });

        if (currentTab === 'latest') items.reverse();
        else items.sort((a, b) => (b.likes || 0) - (a.likes || 0));

        items.forEach(p => {
            // ·ÅÅ·Åã ·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äï·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äæ·ÄÑ·Ä∫·Äõ·Ä≤·Ä∑ ·Äí·Ä±·Äê·Ä¨·ÄÄ·Ä≠·ÄØ Users ·Äë·Ä≤·Äô·Äæ·Ä¨ ·Äû·ÄΩ·Ä¨·Ä∏·Äõ·Äæ·Ä¨·Äô·Äö·Ä∫
            db.ref('users/' + p.uid).once('value', userSnap => {
                const userData = userSnap.val() || {};
                const name = userData.username || p.u; // ·Äî·Ä¨·Äô·Ää·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äô·Äõ·Äæ·Ä≠·Äõ·ÄÑ·Ä∫ ·Ä°·Äü·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äû·ÄØ·Ä∂·Ä∏·Äô·Äö·Ä∫
                const avatar = userData.profilePic || "üë§"; // ·Ä°·ÄÆ·Äô·Ä≠·ÄØ·ÄÇ·Äª·ÄÆ·Ä°·Äû·ÄÖ·Ä∫·Äô·Äõ·Äæ·Ä≠·Äõ·ÄÑ·Ä∫ ·Ä°·Äü·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äû·ÄØ·Ä∂·Ä∏·Äô·Äö·Ä∫

                let repliesHTML = "";
                if(p.replies) {
                    Object.values(p.replies).forEach(r => {
                        // Reply ·Äï·Äº·Äî·Ä∫·Äê·Ä≤·Ä∑·Äû·Ä∞·Äê·ÄΩ·Ä±·Äõ·Ä≤·Ä∑ ·Äí·Ä±·Äê·Ä¨·ÄÄ·Ä≠·ÄØ·Äú·Ää·Ä∫·Ä∏ Real-time ·Äï·Äº·ÄÅ·Äª·ÄÑ·Ä∫·Äõ·ÄÑ·Ä∫ ·Äí·ÄÆ·Äô·Äæ·Ä¨ ·Äë·Äï·Ä∫·Äö·Ä∞·Äõ·Äô·Äö·Ä∫
                        // ·Äí·Ä´·Äï·Ä±·Äô·Ä≤·Ä∑ ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ Reply ·ÄÄ ·Ä°·Äõ·ÄÑ·Ä∫·Ä°·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äï·Ä≤ ·Äë·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫
                        repliesHTML += `
                        <div style="font-size:12px; margin-top:8px; display:flex; align-items:center; gap:8px;">
                            <span>${r.avatar || 'üë§'}</span> 
                            <a href="profile.html?id=${r.uid}" style="color:#00ff41; text-decoration:none; font-weight:bold;">@${r.u}:</a> 
                            <span>${r.m}</span>
                        </div>`;
                    });
                }

                const card = document.createElement('div');
                card.className = "card";
                card.innerHTML = `
                    <div class="user">
                        <div class="avatar">${avatar}</div>
                        <a href="profile.html?id=${p.uid}">@${name}</a>
                    </div>
                    <div class="title">${p.t}</div>
                    <p style="font-size:14px; line-height:1.5;">${p.c}</p>
                    <div class="action-bar">
                        <span class="like-btn" onclick="like('${p.key}')">‚ù§Ô∏è Like (${p.likes||0})</span>
                        <span style="cursor:pointer; color:#888;" onclick="reply('${p.key}')">üí¨ Reply</span>
                    </div>
                    <div class="reply-box">${repliesHTML}</div>`;
                
                feed.appendChild(card);
            });
        });
    });
}
                const card = document.createElement('div');
                card.className = "card";
                card.innerHTML = `
                    <div class="user">
                        <div class="avatar">${p.avatar||'üë§'}</div>
                        <a href="profile.html?id=${p.uid}">@${p.u}</a>
                    </div>
                    <div class="title">${p.t}</div>
                    <p style="font-size:14px; line-height:1.5;">${p.c}</p>
                    <div class="action-bar">
                        <span class="like-btn" onclick="like('${p.key}')">‚ù§Ô∏è Like (${p.likes||0})</span>
                        <span style="cursor:pointer; color:#888;" onclick="reply('${p.key}')">üí¨ Reply</span>
                    </div>
                    <div class="reply-box">${repliesHTML}</div>`;
                feed.appendChild(card);
            });
        });
    }

    function trackPresence(user) {
        const onlineRef = db.ref('online/' + user.uid);
        onlineRef.set(true); onlineRef.onDisconnect().remove();
        db.ref('online').on('value', s => { document.getElementById('online-count').innerText = s.numChildren(); });
        db.ref('users').on('value', s => { document.getElementById('total-count').innerText = s.numChildren(); });
    }

    function switchTab(t) {
        currentTab = t;
        document.getElementById('tab-latest').classList.toggle('active', t==='latest');
        document.getElementById('tab-popular').classList.toggle('active', t==='popular');
        load();
    }

    function logout() { 
        if (confirm("·Äú·Ä¨·Ä∏·Äï·Ä´·Äñ·Ä≠·ÄØ·Ä∑·Äö·Ä¨·Äú·Ä¨·Ä∏?(·Ä°·Ä¨·Ä∏·ÄÄ·Ä±·Äú·Ä¨·Äú·Ää·Ä∫·Äï·Ä´)")) {
            firebase.auth().signOut().then(() => window.location.href = "index.html");
        } 
    }
</script>
</body>
</html>
